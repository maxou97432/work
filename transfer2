# Distribution globale
distribution_global = (
    base_ml.groupby(['TYPE_BIEN', 'NB_PIECES_RANGE'])['ID']
           .count()
           .reset_index(name='Nombre')
)

total_global = distribution_global['Nombre'].sum()
distribution_global['Pourcentage_total'] = (
    distribution_global['Nombre'] / total_global * 100
)

# üîß Tri coh√©rent AVANT le graphique
distribution_global = distribution_global.sort_values(['NB_PIECES_RANGE', 'TYPE_BIEN'])

# üîπ Cr√©ation du graphique corrig√©
fig = px.bar(
    distribution_global,
    x='NB_PIECES_RANGE',
    y='Pourcentage_total',
    color='TYPE_BIEN',
    text=distribution_global['Pourcentage_total'].round(1).astype(str) + '%',
    title="R√©partition des cat√©gories de nombre de pi√®ces (tous biens confondus)",
    color_discrete_map={'APT': '#1f77b4', 'MAI': '#ff7f0e'},
    barmode='group'
)

fig.update_traces(textposition='outside')
fig.update_layout(
    xaxis_title="Cat√©gorie (nombre de pi√®ces)",
    yaxis_title="Part dans le total (%)",
    title_x=0.5,
    xaxis_tickangle=45,
    plot_bgcolor="white",
    legend_title="Type de bien"
)

fig.show()
