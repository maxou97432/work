base_ml["Prix_m2_na"] = base_ml["Prix_m2"].isna()


total = base_ml.groupby("YEAR")["ID"].count()


na = base_ml[base_ml["Prix_m2_na"]].groupby("YEAR")["ID"].count()

pourcentage = (na / total * 100).reset_index(name="Pourcentage_NA")

pourcentage.plot(x='YEAR', y='Pourcentage_NA', kind='bar', legend=False)
plt.title("Évolution annuelle du pourcentage de Prix_m2 manquantes")
plt.xlabel("Année")
plt.ylabel("Pourcentage de valeurs manquantes")
plt.tight_layout()
plt.show()


df_miss = base_ml[base_ml["Prix_m2_na"]]
df_grouped = df_miss.groupby(['YEAR', 'SOURCE'])['ID'].count().reset_index(name='Nombre_transactions_na')

total_na = df_miss.groupby("YEAR")["Prix_m2_na"].count()
pivot_df = df_grouped.pivot(index='YEAR', columns='SOURCE', values='Nombre_transactions_na')
pourcentage_df = pivot_df.div(total_na, axis = 0)*100


pourcentage_df.plot(kind='bar', stacked=False)
plt.title("Évolution annuelle du pourcentage de Prix_m2 manquantes par source")
plt.xlabel("Année")
plt.ylabel("Pourcentage de valeurs manquantes")
plt.legend(title="Source")
plt.tight_layout()
plt.show()
