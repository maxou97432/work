df_surf_na = base_ml["NB_SURF_HAB"].isna().sum()
print(f"{df_surf_na} données manquantes soit {df_surf_na / len(base_ml) * 100} %")
base_ml["NB_SURF_HAB_NA"] = base_ml["NB_SURF_HAB"].isna()


total = base_ml.groupby("YEAR")["ID"].count()


na = base_ml[base_ml["NB_SURF_HAB_NA"]].groupby("YEAR")["ID"].count()

pourcentage = (na / total * 100).reset_index(name="Pourcentage_NA")

pourcentage.plot(x='YEAR', y='Pourcentage_NA', kind='bar', legend=False)
plt.title("Évolution annuelle du pourcentage de NB_SURF_HAB manquantes")
plt.xlabel("Année")
plt.ylabel("Pourcentage de valeurs manquantes")
plt.tight_layout()
plt.show()


df_miss = base_ml[base_ml["NB_SURF_HAB_NA"]]
df_grouped = df_miss.groupby(['YEAR', 'SOURCE'])['ID'].count().reset_index(name='Nombre_transactions_na')

total_na = df_miss.groupby("YEAR")["NB_SURF_HAB_NA"].count()
pivot_df = df_grouped.pivot(index='YEAR', columns='SOURCE', values='Nombre_transactions_na')
pourcentage_df = pivot_df.div(total_na, axis = 0)*100


pourcentage_df.plot(kind='bar', stacked=False)
plt.title("Évolution annuelle du pourcentage de NB_SURF_HAB manquantes par source")
plt.xlabel("Année")
plt.ylabel("Pourcentage de valeurs manquantes")
plt.legend(title="Source")
plt.tight_layout()
plt.show()
