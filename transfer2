import altair as alt

alt.data_transformers.disable_max_rows()

# Agrégation
j = base_ml.groupby('YEAR')['ID'].count().reset_index(name='Nombre_transactions')

# Chart Altair
chart1 = (
    alt.Chart(j)
    .mark_bar(color="#1f77b4")
    .encode(
        x=alt.X('YEAR:O', title='Année', sort='ascending'),
        y=alt.Y('Nombre_transactions:Q', title='Nombre de transactions'),
        tooltip=['YEAR', 'Nombre_transactions']
    )
    .properties(
        title='Évolution annuelle du nombre de transactions',
        width=700,
        height=400
    )
)
chart1.interactive()


# Agrégation équivalente
df_grouped = base_ml.groupby(['YEAR', 'SOURCE'])['ID'].count().reset_index(name='Nombre_transactions')
total_per_year = df_grouped.groupby('YEAR')['Nombre_transactions'].transform('sum')
df_grouped['Pourcentage'] = df_grouped['Nombre_transactions'] / total_per_year * 100

# Chart Altair
chart2 = (
    alt.Chart(df_grouped)
    .mark_bar()
    .encode(
        x=alt.X('YEAR:O', title='Année', sort='ascending'),
        y=alt.Y('Pourcentage:Q', title='Part des transactions (%)'),
        color=alt.Color('SOURCE:N', title='Source'),
        tooltip=['YEAR', 'SOURCE', 'Pourcentage', 'Nombre_transactions']
    )
    .properties(
        title='Évolution annuelle du pourcentage du nombre de transactions par source',
        width=700,
        height=400
    )
)

chart2.interactive()
