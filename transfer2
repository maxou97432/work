{
	"name": "KeyError",
	"message": "'poids_relatif'",
	"stack": "---------------------------------------------------------------------------
KeyError                                  Traceback (most recent call last)
File n:\\uflumth\\indicateur_marche\\prix_m2\\my_cl_estim\\.venv\\Lib\\site-packages\\pandas\\core\\indexes\\base.py:3812, in Index.get_loc(self, key)
   3811 try:
-> 3812     return self._engine.get_loc(casted_key)
   3813 except KeyError as err:

File pandas/_libs/index.pyx:167, in pandas._libs.index.IndexEngine.get_loc()

File pandas/_libs/index.pyx:196, in pandas._libs.index.IndexEngine.get_loc()

File pandas/_libs/hashtable_class_helper.pxi:7088, in pandas._libs.hashtable.PyObjectHashTable.get_item()

File pandas/_libs/hashtable_class_helper.pxi:7096, in pandas._libs.hashtable.PyObjectHashTable.get_item()

KeyError: 'poids_relatif'

The above exception was the direct cause of the following exception:

KeyError                                  Traceback (most recent call last)
Cell In[68], line 114
    108         return pd.Series({\"prix_pondere_mensuel\": np.nan})
    109     return pd.Series({\"prix_pondere_mensuel\": np.average(prix[valid], weights=poids[valid])})
    112 city_month = (
    113     df.groupby([\"Ville\", \"Periode\"], as_index=False)
--> 114       .apply(agg_weighted_monthly)
    115       .dropna(subset=[\"prix_pondere_mensuel\"])
    116 )
    119 city_month = city_month.sort_values([\"Ville\", \"Periode\"])
    120 city_month[\"glissant_3m\"] = (
    121     city_month.groupby(\"Ville\")[\"prix_pondere_mensuel\"]
    122     .transform(lambda s: s.rolling(3, min_periods=1).mean())
    123 )

File n:\\uflumth\\indicateur_marche\\prix_m2\\my_cl_estim\\.venv\\Lib\\site-packages\\pandas\\core\\groupby\\groupby.py:1826, in GroupBy.apply(self, func, include_groups, *args, **kwargs)
   1824 with option_context(\"mode.chained_assignment\", None):
   1825     try:
-> 1826         result = self._python_apply_general(f, self._selected_obj)
   1827         if (
   1828             not isinstance(self.obj, Series)
   1829             and self._selection is None
   1830             and self._selected_obj.shape != self._obj_with_exclusions.shape
   1831         ):
   1832             warnings.warn(
   1833                 message=_apply_groupings_depr.format(
   1834                     type(self).__name__, \"apply\"
   (...)   1837                 stacklevel=find_stack_level(),
   1838             )

File n:\\uflumth\\indicateur_marche\\prix_m2\\my_cl_estim\\.venv\\Lib\\site-packages\\pandas\\core\\groupby\\groupby.py:1887, in GroupBy._python_apply_general(self, f, data, not_indexed_same, is_transform, is_agg)
   1852 @final
   1853 def _python_apply_general(
   1854     self,
   (...)   1859     is_agg: bool = False,
   1860 ) -> NDFrameT:
   1861     \"\"\"
   1862     Apply function f in python space
   1863 
   (...)   1885         data after applying f
   1886     \"\"\"
-> 1887     values, mutated = self._grouper.apply_groupwise(f, data, self.axis)
   1888     if not_indexed_same is None:
   1889         not_indexed_same = mutated

File n:\\uflumth\\indicateur_marche\\prix_m2\\my_cl_estim\\.venv\\Lib\\site-packages\\pandas\\core\\groupby\\ops.py:928, in BaseGrouper.apply_groupwise(self, f, data, axis)
    926 # group might be modified
    927 group_axes = group.axes
--> 928 res = f(group)
    929 if not mutated and not _is_indexed_like(res, group_axes, axis):
    930     mutated = True

Cell In[68], line 105, in agg_weighted_monthly(g)
    103 \"\"\"Calcule le prix moyen pondéré structurellement pour chaque ville et mois\"\"\"
    104 prix = g[\"prix_moyen\"]
--> 105 poids = g[\"poids_relatif\"]
    106 valid = poids > 0
    107 if valid.sum() == 0:

File n:\\uflumth\\indicateur_marche\\prix_m2\\my_cl_estim\\.venv\\Lib\\site-packages\\pandas\\core\\frame.py:4113, in DataFrame.__getitem__(self, key)
   4111 if self.columns.nlevels > 1:
   4112     return self._getitem_multilevel(key)
-> 4113 indexer = self.columns.get_loc(key)
   4114 if is_integer(indexer):
   4115     indexer = [indexer]

File n:\\uflumth\\indicateur_marche\\prix_m2\\my_cl_estim\\.venv\\Lib\\site-packages\\pandas\\core\\indexes\\base.py:3819, in Index.get_loc(self, key)
   3814     if isinstance(casted_key, slice) or (
   3815         isinstance(casted_key, abc.Iterable)
   3816         and any(isinstance(x, slice) for x in casted_key)
   3817     ):
   3818         raise InvalidIndexError(key)
-> 3819     raise KeyError(key) from err
   3820 except TypeError:
   3821     # If we have a listlike key, _check_indexing_error will raise
   3822     #  InvalidIndexError. Otherwise we fall through and re-raise
   3823     #  the TypeError.
   3824     self._check_indexing_error(key)

KeyError: 'poids_relatif'"
}
