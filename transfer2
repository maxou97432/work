from prophet import Prophet
from prophet.plot import plot_plotly
import plotly.io as pio
import plotly.graph_objects as go
pio.renderers.default = "notebook"

cols = [
    "Prix moyen glissant 12 mois - Univ Elem",
    "Prix moyen glissant 12 mois - LPI/IAD",
    "Prix moyen glissant 12 mois - CL",
    "Prix moyen glissant 3 mois - Univ Elem"

]
for ville in fusion["Ville"].unique():
    df_ville = fusion[fusion["Ville"] == ville].copy()
    fig = go.Figure()
    for col in cols:
        df_col = fusion[fusion["Ville"] == ville][["DATE",col]].rename(columns={"DATE":"ds", col: "y"})
        df_col =df_col.dropna(subset=["y"])
        model = Prophet()
        model.fit(df_col)
        future = model.make_future_dataframe(periods = 12, freq = "M")
        forecast = model.predict(future)
        fig = plot_plotly(model,forecast)

    fig.update_layout(
        title= f"Prévision Prophet de toutes les méthodes - {ville}",
        xaxis_title = "Date",
        yaxis_title = "Prix au m2",
        template = 'plotly_white',
        legend = dict(yanchor = "bottom", y= 0.01, xanchor="right",x=0.99, bgcolor ="rgba(255,255,255,0.6)"),
        height = 550
    )
    fig.show()
