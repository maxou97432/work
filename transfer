df_merged.loc[mask, 'mean_6m_3m'] = (
    (df_merged.loc[mask, 'mean_6m'] * df_merged.loc[mask, 'nb_bien_6m']) -
    (df_merged.loc[mask, 'mean_3m'] * df_merged.loc[mask, 'nb_bien_3m'])
)

df_merged.loc[~mask, 'mean_6m_3m'] = (
    ((df_merged.loc[~mask, 'mean_6m'] * df_merged.loc[~mask, 'nb_bien_6m']) -
    (df_merged.loc[~mask, 'mean_3m'] * df_merged.loc[~mask, 'nb_bien_3m'])) /
    (df_merged.loc[~mask, 'nb_bien_6m'] - df_merged.loc[~mask, 'nb_bien_3m'])
)
