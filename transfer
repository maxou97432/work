import pandas as pd

# --- Préparer df_final pour la comparaison ---
# On va extraire les colonnes 'ALL' pour chaque période (3, 6 et 12 mois)
df_compare = pd.DataFrame(index=df_final.index)

for period, label in zip(['3 mois', '6 mois', '12 mois'], ['3m', '6m', '12m']):
    if (period, 'ALL') in df_final.columns:
        df_compare[f'MA Crédit {label}'] = df_final[(period, 'ALL')].replace('-', pd.NA).str.replace(' €','').str.replace(' ','').astype(float)

# --- Préparer df_moyennes pour la comparaison ---
# Retirer le numéro du département pour correspondre aux noms de df_final
df_moyennes_index_clean = df_moyennes.copy()
df_moyennes_index_clean.index = df_moyennes_index_clean.index.str.split(' - ').str[1]

# Renommer les colonnes pour correspondance
df_moyennes_index_clean = df_moyennes_index_clean.rename(columns={
    'Moyenne 3 derniers mois': 'MA Meilleurs Agents 3m',
    'Moyenne 6 derniers mois': 'MA Meilleurs Agents 6m',
    'Moyenne 12 derniers mois': 'MA Meilleurs Agents 12m'
})

# --- Fusionner les deux tableaux sur le département ---
df_final_compare = df_compare.merge(df_moyennes_index_clean, left_index=True, right_index=True, how='outer')

# --- Affichage final, avec formatting €
for col in df_final_compare.columns:
    df_final_compare[col] = df_final_compare[col].apply(lambda x: f"{x:,.0f} €" if pd.notna(x) else '-')

# Affichage
print(df_final_compare)
