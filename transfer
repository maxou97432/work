# Fusion Crédit Logement (CL) et Meilleurs Agents (MA)

# On récupère les prix CL (moyenne sur 6 mois par département)
df_CL = df_prix_m2_dept[["Département", "CD_TYP_BIEN", "mean_6m"]].copy()
df_CL = df_CL.rename(columns={"mean_6m": "Prix_CL"})

# On récupère les prix MA (moyenne sur 6 mois)
df_MA = df_moyennes[["Moyenne 6 derniers mois"]].reset_index()
df_MA = df_MA.rename(columns={
    "Départements": "Département",
    "Moyenne 6 derniers mois": "Prix_MA"
})

# Fusion
df_comparaison = pd.merge(
    df_CL[df_CL["CD_TYP_BIEN"] == "ALL"],  # uniquement "tous biens" pour comparer
    df_MA,
    on="Département",
    how="inner"
)

# Ajout des écarts
df_comparaison["Ecart_abs (€)"] = df_comparaison["Prix_CL"] - df_comparaison["Prix_MA"]
df_comparaison["Ecart_%"] = (
    (df_comparaison["Prix_CL"] - df_comparaison["Prix_MA"]) / df_comparaison["Prix_MA"] * 100
).round(2)

# Affichage
df_comparaison.head(20)
